# ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€ UI ë””ìì¸

## 1. í˜ì´ì§€ ê°œìš”

**ëª©ì **: ëª¨ë“  ê³„ì¢Œë¥¼ í†µí•©í•˜ì—¬ ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ í˜„í™©ì„ í•œëˆˆì— íŒŒì•…

**ì£¼ìš” ê¸°ëŠ¥**:
- Sunburst Chart (ê³„ì¸µì  ìì‚° êµ¬ì„± ì‹œê°í™”)
- ì¢…ëª© ê²€ìƒ‰ ê¸°ëŠ¥ (ì§ì ‘ ë³´ìœ  + ETF ë‚´ ê°„ì ‘ ë³´ìœ )
- í†µí•© ì„¹í„° ë¹„ì¤‘ (Horizontal Bar Chart)
- Top 20 ë³´ìœ  ì¢…ëª©
- ìì‚° ìœ í˜•ë³„ ìš”ì•½ (STOCK/BOND/CASH)

## 2. ë ˆì´ì•„ì›ƒ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ† ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ - 2025-12                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  ğŸ’° ìì‚° ìœ í˜•ë³„ ìš”ì•½                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ ğŸ“ˆ ì£¼ì‹í˜• â”‚  â”‚ ğŸ’µ ì±„ê¶Œí˜• â”‚  â”‚ ğŸ’° í˜„ê¸ˆí˜• â”‚                     â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚                     â”‚
â”‚  â”‚ 819,982ì›â”‚  â”‚ 300,000ì›â”‚  â”‚ 350,000ì›â”‚                     â”‚
â”‚  â”‚  55.8%   â”‚  â”‚  20.4%   â”‚  â”‚  23.8%   â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŒ ìì‚° êµ¬ì„± (Sunburst Chart)                                  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        ROOT                              â”‚ â”‚
â”‚  â”‚                    â•±    â”‚    â•²                          â”‚ â”‚
â”‚  â”‚                  â•±      â”‚      â•²                        â”‚ â”‚
â”‚  â”‚              STOCK    BOND    CASH                      â”‚ â”‚
â”‚  â”‚              55.8%    20.4%   23.8%                     â”‚ â”‚
â”‚  â”‚             â•±  â”‚  â•²     â”‚                               â”‚ â”‚
â”‚  â”‚          Tech Fin Health                                â”‚ â”‚
â”‚  â”‚          42%  8%  6%                                     â”‚ â”‚
â”‚  â”‚         â•± â”‚ â•²                                           â”‚ â”‚
â”‚  â”‚      AAPL MSFT NVDA                                     â”‚ â”‚
â”‚  â”‚      3.2% 2.9% 3.3%                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  ğŸ’¡ ì°¨íŠ¸ë¥¼ í´ë¦­í•˜ë©´ ì„¸ë¶€ í•­ëª©ìœ¼ë¡œ ë“œë¦´ë‹¤ìš´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.          â”‚
â”‚                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” ì¢…ëª© ê²€ìƒ‰                                                   â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ì¢…ëª© ì½”ë“œ ì…ë ¥: [ AAPL              ] ğŸ”               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚
â”‚  ğŸ“Š ê²€ìƒ‰ ê²°ê³¼: AAPL (Apple Inc.)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ ì§ì ‘ ë³´ìœ :   10.00ì£¼  (150,000ì›)                      â”‚ â”‚
â”‚  â”‚ â€¢ ETF í†µí•´:     3.50ì£¼  ( 52,500ì›)                      â”‚ â”‚
â”‚  â”‚   - SPYì—ì„œ:   2.00ì£¼  ( 30,000ì›)                       â”‚ â”‚
â”‚  â”‚   - QQQì—ì„œ:   1.50ì£¼  ( 22,500ì›)                       â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚ â”‚
â”‚  â”‚ âœ… ì´ ë³´ìœ :    13.50ì£¼  (202,500ì›)                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š í†µí•© ì„¹í„° ë¹„ì¤‘ (Top 10)                                     â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Technology          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 42.4%  (347,000ì›)â”‚ â”‚
â”‚  â”‚ Cash & Equivalents  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 23.8%         (350,000ì›)â”‚ â”‚
â”‚  â”‚ Fixed Income        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 20.4%          (300,000ì›)â”‚ â”‚
â”‚  â”‚ Communication       â–ˆâ–ˆâ–ˆâ–ˆ 10.8%                 (88,000ì›)â”‚ â”‚
â”‚  â”‚ Healthcare          â–ˆâ–ˆ 5.2%                    (42,000ì›)â”‚ â”‚
â”‚  â”‚ Financials          â–ˆ 3.1%                     (25,000ì›)â”‚ â”‚
â”‚  â”‚ ...                                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ… í†µí•© ë³´ìœ  ì¢…ëª© Top 20                                       â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ìˆœìœ„â”‚ ì¢…ëª©        â”‚ ìœ í˜•  â”‚ ê¸ˆì•¡      â”‚ ë¹„ì¤‘  â”‚ ì¶œì²˜      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  1  â”‚ ì¼ë°˜ì ê¸ˆ     â”‚ CASH  â”‚ 300,000ì› â”‚ 20.4% â”‚ ISA       â”‚ â”‚
â”‚  â”‚  2  â”‚ TLT         â”‚ BOND  â”‚ 300,000ì› â”‚ 20.4% â”‚ ISA       â”‚ â”‚
â”‚  â”‚  3  â”‚ ì‚¼ì„±ì „ì    â”‚ STOCK â”‚ 150,000ì› â”‚ 10.2% â”‚ ì¼ë°˜      â”‚ â”‚
â”‚  â”‚  4  â”‚ NVDA        â”‚ STOCK â”‚  49,190ì› â”‚  3.3% â”‚ SPY,QQQ   â”‚ â”‚
â”‚  â”‚  5  â”‚ AAPL        â”‚ STOCK â”‚  47,205ì› â”‚  3.2% â”‚ SPY,QQQ   â”‚ â”‚
â”‚  â”‚  6  â”‚ MSFT        â”‚ STOCK â”‚  42,860ì› â”‚  2.9% â”‚ SPY,QQQ   â”‚ â”‚
â”‚  â”‚  7  â”‚ GOOGL       â”‚ STOCK â”‚  31,200ì› â”‚  2.1% â”‚ SPY,QQQ   â”‚ â”‚
â”‚  â”‚ ... â”‚ ...         â”‚ ...   â”‚ ...       â”‚ ...   â”‚ ...       â”‚ â”‚
â”‚  â”‚ 20  â”‚ JPM         â”‚ STOCK â”‚  12,500ì› â”‚  0.8% â”‚ SPY       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  ğŸ’¡ ETF ë‚´ë¶€ ì¢…ëª©ì€ [ì¶œì²˜] ì»¬ëŸ¼ì— ETF ì´ë¦„ì´ í‘œì‹œë©ë‹ˆë‹¤.          â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. ì»´í¬ë„ŒíŠ¸ ìƒì„¸ ì„¤ê³„

### 3.1 ìì‚° ìœ í˜•ë³„ ìš”ì•½ (Metric Cards)

**ì»´í¬ë„ŒíŠ¸**: `st.metric()`

```python
def render(selected_month: str):
    """ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€ ë Œë”ë§"""

    st.header(f"ğŸ† ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ - {selected_month}")

    # ìì‚° ìœ í˜•ë³„ ìš”ì•½ ì¡°íšŒ
    asset_summary = get_asset_type_summary(selected_month)

    st.subheader("ğŸ’° ìì‚° ìœ í˜•ë³„ ìš”ì•½")
    col1, col2, col3 = st.columns(3)

    total = asset_summary['STOCK'] + asset_summary['BOND'] + asset_summary['CASH']

    with col1:
        st.metric(
            "ğŸ“ˆ ì£¼ì‹í˜•",
            f"{asset_summary['STOCK']:,}ì›",
            delta=f"{asset_summary['STOCK']/total*100:.1f}%"
        )

    with col2:
        st.metric(
            "ğŸ’µ ì±„ê¶Œí˜•",
            f"{asset_summary['BOND']:,}ì›",
            delta=f"{asset_summary['BOND']/total*100:.1f}%"
        )

    with col3:
        st.metric(
            "ğŸ’° í˜„ê¸ˆí˜•",
            f"{asset_summary['CASH']:,}ì›",
            delta=f"{asset_summary['CASH']/total*100:.1f}%"
        )

    st.divider()
```

**ë°ì´í„° êµ¬ì¡°** (`asset_summary`):
```python
{
    'STOCK': 819982,
    'BOND': 300000,
    'CASH': 350000
}
```

### 3.2 Sunburst Chart (í•µì‹¬ ì°¨íŠ¸)

**ì»´í¬ë„ŒíŠ¸**: `plotly.graph_objects.Sunburst`

```python
import plotly.graph_objects as go

def create_sunburst_chart(selected_month: str):
    """
    ê³„ì¸µ êµ¬ì¡°:
    ROOT
      â”œâ”€ STOCK (55.8%)
      â”‚    â”œâ”€ Technology (42.4%)
      â”‚    â”‚    â”œâ”€ AAPL (3.2%)
      â”‚    â”‚    â”œâ”€ MSFT (2.9%)
      â”‚    â”‚    â””â”€ NVDA (3.3%)
      â”‚    â”œâ”€ Communication (10.8%)
      â”‚    â””â”€ Healthcare (5.2%)
      â”œâ”€ BOND (20.4%)
      â”‚    â””â”€ Fixed Income (20.4%)
      â”‚         â””â”€ TLT (20.4%)
      â””â”€ CASH (23.8%)
           â””â”€ Cash & Equivalents (23.8%)
                â””â”€ ì¼ë°˜ì ê¸ˆ (20.4%)
    """

    # ê³„ì¸µ ë°ì´í„° ì¡°íšŒ
    df = get_hierarchical_portfolio_data(selected_month)

    # Sunburst ì°¨íŠ¸ ìƒì„±
    fig = go.Figure(go.Sunburst(
        labels=df['labels'],
        parents=df['parents'],
        values=df['values'],
        branchvalues="total",  # ë¶€ëª¨ ê°’ = ìì‹ ê°’ í•©ê³„
        marker=dict(
            colors=df['colors'],
            line=dict(color='white', width=2)
        ),
        hovertemplate='<b>%{label}</b><br>ê¸ˆì•¡: %{value:,}ì›<br>ë¹„ì¤‘: %{percentParent}<extra></extra>'
    ))

    fig.update_layout(
        title="ğŸŒ ìì‚° êµ¬ì„± (Sunburst Chart)",
        height=600,
        margin=dict(t=50, l=0, r=0, b=0)
    )

    return fig

# ë Œë”ë§
st.subheader("ğŸŒ ìì‚° êµ¬ì„±")
fig = create_sunburst_chart(selected_month)
st.plotly_chart(fig, use_container_width=True)
st.caption("ğŸ’¡ ì°¨íŠ¸ë¥¼ í´ë¦­í•˜ë©´ ì„¸ë¶€ í•­ëª©ìœ¼ë¡œ ë“œë¦´ë‹¤ìš´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
```

**ë°ì´í„° êµ¬ì¡°** (`df`):
```python
   labels              parents          values    colors
0  ROOT                ""               1469982   #ffffff
1  STOCK               ROOT             819982    #3498db
2  BOND                ROOT             300000    #2ecc71
3  CASH                ROOT             350000    #f39c12
4  Technology          STOCK            347000    #3498db
5  Communication       STOCK            88000     #3498db
6  AAPL                Technology       47205     #85c1e9
7  MSFT                Technology       42860     #85c1e9
8  NVDA                Technology       49190     #85c1e9
9  Fixed Income        BOND             300000    #2ecc71
10 TLT                 Fixed Income     300000    #82e0aa
11 Cash & Equivalents  CASH             350000    #f39c12
12 ì¼ë°˜ì ê¸ˆ             Cash & Equivalents 300000  #f8c471
...
```

### 3.3 ì¢…ëª© ê²€ìƒ‰ ê¸°ëŠ¥ (í‚¬ëŸ¬ ê¸°ëŠ¥)

**ì»´í¬ë„ŒíŠ¸**: `st.text_input()` + `st.metric()`

```python
def render_stock_search(selected_month: str):
    """ì¢…ëª© ê²€ìƒ‰ ì„¹ì…˜"""

    st.subheader("ğŸ” ì¢…ëª© ê²€ìƒ‰")

    # ê²€ìƒ‰ ì…ë ¥
    search_ticker = st.text_input(
        "ì¢…ëª© ì½”ë“œ ì…ë ¥",
        placeholder="ì˜ˆ: AAPL, NVDA, 005930.KS",
        help="ì§ì ‘ ë³´ìœ  + ETF ë‚´ ê°„ì ‘ ë³´ìœ ë¥¼ ëª¨ë‘ ê²€ìƒ‰í•©ë‹ˆë‹¤"
    )

    if not search_ticker:
        st.info("ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•˜ë©´ ì§ì ‘ ë³´ìœ ì™€ ETFë¥¼ í†µí•œ ê°„ì ‘ ë³´ìœ ë¥¼ ëª¨ë‘ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
        return

    # ê²€ìƒ‰ ì‹¤í–‰
    with st.spinner(f"{search_ticker} ê²€ìƒ‰ ì¤‘..."):
        result = search_total_holdings(selected_month, search_ticker.strip().upper())

    if not result:
        st.warning(f"'{search_ticker}' ì¢…ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return

    # ê²°ê³¼ í‘œì‹œ
    st.success(f"ğŸ“Š ê²€ìƒ‰ ê²°ê³¼: {result['ticker']} ({result['name']})")

    col1, col2 = st.columns(2)

    with col1:
        st.metric(
            "ğŸ’¼ ì§ì ‘ ë³´ìœ ",
            f"{result['direct_shares']:.2f}ì£¼",
            delta=f"{result['direct_value']:,}ì›"
        )

    with col2:
        st.metric(
            "ğŸ“¦ ETF í†µí•´",
            f"{result['etf_shares']:.2f}ì£¼",
            delta=f"{result['etf_value']:,}ì›"
        )

    # ETFë³„ ìƒì„¸ ë‚´ì—­
    if result['etf_details']:
        st.caption("ETFë³„ ìƒì„¸ ë‚´ì—­:")
        for etf_name, shares, value in result['etf_details']:
            st.caption(f"  â€¢ {etf_name}ì—ì„œ: {shares:.2f}ì£¼ ({value:,}ì›)")

    st.divider()

    # ì´ê³„
    st.metric(
        "âœ… ì´ ë³´ìœ ",
        f"{result['total_shares']:.2f}ì£¼",
        delta=f"{result['total_value']:,}ì›"
    )
```

**ë°ì´í„° êµ¬ì¡°** (`result`):
```python
{
    'ticker': 'AAPL',
    'name': 'Apple Inc.',
    'direct_shares': 10.0,        # ì§ì ‘ ë³´ìœ  ìˆ˜ëŸ‰
    'direct_value': 150000,       # ì§ì ‘ ë³´ìœ  ê¸ˆì•¡
    'etf_shares': 3.5,            # ETF í†µí•´ ë³´ìœ  ìˆ˜ëŸ‰
    'etf_value': 52500,           # ETF í†µí•´ ë³´ìœ  ê¸ˆì•¡
    'etf_details': [              # ETFë³„ ìƒì„¸
        ('SPY', 2.0, 30000),
        ('QQQ', 1.5, 22500)
    ],
    'total_shares': 13.5,         # ì´ ë³´ìœ  ìˆ˜ëŸ‰
    'total_value': 202500         # ì´ ë³´ìœ  ê¸ˆì•¡
}
```

### 3.4 í†µí•© ì„¹í„° ë¹„ì¤‘ (Horizontal Bar Chart)

**ì»´í¬ë„ŒíŠ¸**: `plotly.graph_objects.Bar`

```python
import plotly.graph_objects as go

def create_sector_bar_chart(selected_month: str, top_n: int = 10):
    """
    í†µí•© ì„¹í„° ë¹„ì¤‘ Horizontal Bar Chart
    """
    # ë°ì´í„° ì¡°íšŒ
    df_sectors = get_total_sectors(selected_month, top_n=top_n)

    fig = go.Figure(go.Bar(
        x=df_sectors['amount'],
        y=df_sectors['sector_name'],
        orientation='h',
        text=[f"{pct:.1f}% ({amt:,}ì›)" for pct, amt in zip(df_sectors['percent'], df_sectors['amount'])],
        textposition='outside',
        marker=dict(
            color=df_sectors['amount'],
            colorscale='Blues',
            showscale=False
        )
    ))

    fig.update_layout(
        title=f"ğŸ“Š í†µí•© ì„¹í„° ë¹„ì¤‘ (Top {top_n})",
        xaxis_title="ê¸ˆì•¡ (ì›)",
        yaxis_title="",
        xaxis_tickformat=",",
        height=400,
        yaxis={'categoryorder': 'total ascending'}  # ê¸ˆì•¡ ìˆœ ì •ë ¬
    )

    return fig

# ë Œë”ë§
st.subheader("ğŸ“Š í†µí•© ì„¹í„° ë¹„ì¤‘")
fig = create_sector_bar_chart(selected_month, top_n=10)
st.plotly_chart(fig, use_container_width=True)
```

### 3.5 Top 20 ë³´ìœ  ì¢…ëª© í…Œì´ë¸”

**ì»´í¬ë„ŒíŠ¸**: `st.dataframe()`

```python
def render_top_holdings(selected_month: str, top_n: int = 20):
    """ìƒìœ„ ë³´ìœ  ì¢…ëª© í…Œì´ë¸”"""

    st.subheader(f"ğŸ… í†µí•© ë³´ìœ  ì¢…ëª© Top {top_n}")

    # ë°ì´í„° ì¡°íšŒ
    df = get_total_top_holdings(selected_month, top_n=top_n)

    # í¬ë§·íŒ…
    df_display = df.copy()
    df_display['ìˆœìœ„'] = range(1, len(df) + 1)
    df_display['ê¸ˆì•¡'] = df_display['amount'].apply(lambda x: f"{x:,}ì›")
    df_display['ë¹„ì¤‘'] = df_display['percent'].apply(lambda x: f"{x:.1f}%")

    # í…Œì´ë¸” í‘œì‹œ
    st.dataframe(
        df_display[['ìˆœìœ„', 'ì¢…ëª©', 'ìœ í˜•', 'ê¸ˆì•¡', 'ë¹„ì¤‘', 'ì¶œì²˜']],
        use_container_width=True,
        hide_index=True
    )

    st.caption("ğŸ’¡ ETF ë‚´ë¶€ ì¢…ëª©ì€ [ì¶œì²˜] ì»¬ëŸ¼ì— ETF ì´ë¦„ì´ í‘œì‹œë©ë‹ˆë‹¤.")
```

**ë°ì´í„° êµ¬ì¡°** (`df`):
```python
   ì¢…ëª©        ìœ í˜•   amount   percent  ì¶œì²˜
0  ì¼ë°˜ì ê¸ˆ    CASH   300000   20.4     ISA
1  TLT        BOND   300000   20.4     ISA
2  ì‚¼ì„±ì „ì   STOCK  150000   10.2     ì¼ë°˜
3  NVDA       STOCK   49190    3.3     SPY,QQQ
4  AAPL       STOCK   47205    3.2     SPY,QQQ
...
```

## 4. ë°ì´í„° ìš”êµ¬ì‚¬í•­

### 4.1 í•„ìš”í•œ í•¨ìˆ˜ (`data_loader.py`)

```python
@st.cache_data(ttl=3600)
def get_asset_type_summary(year_month: str) -> dict:
    """
    ìì‚° ìœ í˜•ë³„ ìš”ì•½

    Returns:
        {'STOCK': int, 'BOND': int, 'CASH': int}
    """
    pass

@st.cache_data(ttl=3600)
def get_hierarchical_portfolio_data(year_month: str) -> pd.DataFrame:
    """
    Sunburst ì°¨íŠ¸ìš© ê³„ì¸µ ë°ì´í„°

    Columns: ['labels', 'parents', 'values', 'colors']
    """
    pass

@st.cache_data(ttl=3600)
def search_total_holdings(year_month: str, ticker: str) -> dict:
    """
    ì¢…ëª© ê²€ìƒ‰ (ì§ì ‘ + ETF í†µí•©)

    Returns:
        {
            'ticker': str,
            'name': str,
            'direct_shares': float,
            'direct_value': int,
            'etf_shares': float,
            'etf_value': int,
            'etf_details': List[Tuple],
            'total_shares': float,
            'total_value': int
        }
    """
    pass

@st.cache_data(ttl=3600)
def get_total_sectors(year_month: str, top_n: int = 10) -> pd.DataFrame:
    """
    í†µí•© ì„¹í„° ë¹„ì¤‘ (Top N)

    Columns: ['sector_name', 'amount', 'percent']
    """
    pass

@st.cache_data(ttl=3600)
def get_total_top_holdings(year_month: str, top_n: int = 20) -> pd.DataFrame:
    """
    í†µí•© ë³´ìœ  ì¢…ëª© Top N

    Columns: ['ì¢…ëª©', 'ìœ í˜•', 'amount', 'percent', 'ì¶œì²˜']
    """
    pass
```

### 4.2 DB ì¿¼ë¦¬ ë¡œì§

```sql
-- ìì‚° ìœ í˜•ë³„ ìš”ì•½
SELECT
    asset_type,
    SUM(my_amount) as total_amount
FROM analyzed_holdings
WHERE month_id = (SELECT id FROM months WHERE year_month = '2025-12')
  AND account_id IS NULL
GROUP BY asset_type;

-- í†µí•© ì„¹í„° ë¹„ì¤‘
SELECT
    sector_name,
    SUM(my_amount) as amount,
    SUM(my_amount) * 100.0 / (SELECT SUM(my_amount) FROM analyzed_holdings WHERE ...) as percent
FROM analyzed_sectors
WHERE month_id = (SELECT id FROM months WHERE year_month = '2025-12')
  AND account_id IS NULL
GROUP BY sector_name
ORDER BY amount DESC
LIMIT 10;

-- ì¢…ëª© ê²€ìƒ‰ (ì§ì ‘ ë³´ìœ )
SELECT SUM(amount) as direct_value
FROM holdings
WHERE ticker_mapping = 'AAPL' AND ...;

-- ì¢…ëª© ê²€ìƒ‰ (ETF í†µí•´)
SELECT
    source_ticker,
    SUM(my_amount) as etf_value
FROM analyzed_holdings
WHERE stock_symbol = 'AAPL' AND ...
GROUP BY source_ticker;
```

## 5. ì¸í„°ë™ì…˜ ë° UX

### 5.1 Sunburst ë“œë¦´ë‹¤ìš´

```python
# Plotly SunburstëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í´ë¦­ ì‹œ ë“œë¦´ë‹¤ìš´ ì§€ì›
# í´ë¦­í•˜ë©´ í•´ë‹¹ ë…¸ë“œê°€ ì¤‘ì‹¬ìœ¼ë¡œ í™•ëŒ€ë¨
# ë‹¤ì‹œ ì¤‘ì‹¬ì„ í´ë¦­í•˜ë©´ ìƒìœ„ë¡œ ëŒì•„ê°
```

### 5.2 ê²€ìƒ‰ì–´ ìë™ ëŒ€ë¬¸ì ë³€í™˜

```python
search_ticker = st.text_input("ì¢…ëª© ì½”ë“œ ì…ë ¥")
if search_ticker:
    search_ticker = search_ticker.strip().upper()  # ìë™ ëŒ€ë¬¸ì ë³€í™˜
```

### 5.3 ë¡œë”© ì¸ë””ì¼€ì´í„°

```python
with st.spinner("ë°ì´í„° ë¡œë”© ì¤‘..."):
    df = get_total_top_holdings(selected_month)
```

## 6. ì—ëŸ¬ ì²˜ë¦¬

### 6.1 ë°ì´í„° ì—†ìŒ

```python
df = get_total_top_holdings(selected_month)

if df.empty:
    st.warning("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
    st.stop()
```

### 6.2 ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ

```python
result = search_total_holdings(selected_month, ticker)

if not result:
    st.warning(f"'{ticker}' ì¢…ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
```

## 7. ì™„ì„± ì½”ë“œ ìŠ¤ì¼€ì¹˜

```python
# streamlit_app/pages/total_portfolio.py

import streamlit as st
import plotly.graph_objects as go
from streamlit_app.data_loader import (
    get_asset_type_summary,
    get_hierarchical_portfolio_data,
    search_total_holdings,
    get_total_sectors,
    get_total_top_holdings
)

def render(selected_month: str):
    """ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€ ë Œë”ë§"""

    st.header(f"ğŸ† ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ - {selected_month}")

    # 1. ìì‚° ìœ í˜•ë³„ ìš”ì•½
    render_asset_type_summary(selected_month)
    st.divider()

    # 2. Sunburst Chart
    render_sunburst_chart(selected_month)
    st.divider()

    # 3. ì¢…ëª© ê²€ìƒ‰
    render_stock_search(selected_month)
    st.divider()

    # 4. í†µí•© ì„¹í„° ë¹„ì¤‘
    render_sector_chart(selected_month)
    st.divider()

    # 5. Top 20 Holdings
    render_top_holdings(selected_month)


def render_asset_type_summary(selected_month: str):
    """ìì‚° ìœ í˜•ë³„ ìš”ì•½"""
    summary = get_asset_type_summary(selected_month)
    total = sum(summary.values())

    st.subheader("ğŸ’° ìì‚° ìœ í˜•ë³„ ìš”ì•½")
    col1, col2, col3 = st.columns(3)

    with col1:
        st.metric("ğŸ“ˆ ì£¼ì‹í˜•", f"{summary['STOCK']:,}ì›",
                  delta=f"{summary['STOCK']/total*100:.1f}%")

    with col2:
        st.metric("ğŸ’µ ì±„ê¶Œí˜•", f"{summary['BOND']:,}ì›",
                  delta=f"{summary['BOND']/total*100:.1f}%")

    with col3:
        st.metric("ğŸ’° í˜„ê¸ˆí˜•", f"{summary['CASH']:,}ì›",
                  delta=f"{summary['CASH']/total*100:.1f}%")


def render_sunburst_chart(selected_month: str):
    """Sunburst ì°¨íŠ¸"""
    st.subheader("ğŸŒ ìì‚° êµ¬ì„±")

    with st.spinner("ì°¨íŠ¸ ìƒì„± ì¤‘..."):
        fig = create_sunburst_chart(selected_month)

    st.plotly_chart(fig, use_container_width=True)
    st.caption("ğŸ’¡ ì°¨íŠ¸ë¥¼ í´ë¦­í•˜ë©´ ì„¸ë¶€ í•­ëª©ìœ¼ë¡œ ë“œë¦´ë‹¤ìš´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")


def render_stock_search(selected_month: str):
    """ì¢…ëª© ê²€ìƒ‰"""
    st.subheader("ğŸ” ì¢…ëª© ê²€ìƒ‰")

    search_ticker = st.text_input("ì¢…ëª© ì½”ë“œ ì…ë ¥", placeholder="ì˜ˆ: AAPL")

    if not search_ticker:
        st.info("ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
        return

    result = search_total_holdings(selected_month, search_ticker.upper())

    if not result:
        st.warning(f"'{search_ticker}' ì¢…ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return

    st.success(f"ğŸ“Š {result['ticker']} ({result['name']})")

    col1, col2 = st.columns(2)
    with col1:
        st.metric("ğŸ’¼ ì§ì ‘", f"{result['direct_shares']:.2f}ì£¼",
                  delta=f"{result['direct_value']:,}ì›")
    with col2:
        st.metric("ğŸ“¦ ETF", f"{result['etf_shares']:.2f}ì£¼",
                  delta=f"{result['etf_value']:,}ì›")

    st.metric("âœ… ì´ê³„", f"{result['total_shares']:.2f}ì£¼",
              delta=f"{result['total_value']:,}ì›")


def render_sector_chart(selected_month: str):
    """ì„¹í„° ì°¨íŠ¸"""
    st.subheader("ğŸ“Š í†µí•© ì„¹í„° ë¹„ì¤‘")
    fig = create_sector_bar_chart(selected_month)
    st.plotly_chart(fig, use_container_width=True)


def render_top_holdings(selected_month: str):
    """Top 20 Holdings"""
    st.subheader("ğŸ… Top 20 ë³´ìœ  ì¢…ëª©")

    df = get_total_top_holdings(selected_month, top_n=20)

    df_display = df.copy()
    df_display['ìˆœìœ„'] = range(1, len(df) + 1)
    df_display['ê¸ˆì•¡'] = df_display['amount'].apply(lambda x: f"{x:,}ì›")
    df_display['ë¹„ì¤‘'] = df_display['percent'].apply(lambda x: f"{x:.1f}%")

    st.dataframe(df_display[['ìˆœìœ„', 'ì¢…ëª©', 'ìœ í˜•', 'ê¸ˆì•¡', 'ë¹„ì¤‘', 'ì¶œì²˜']],
                 use_container_width=True, hide_index=True)

    st.caption("ğŸ’¡ ETF ë‚´ë¶€ ì¢…ëª©ì€ [ì¶œì²˜]ì— í‘œì‹œë©ë‹ˆë‹¤.")
```
