# ê³„ì¢Œë³„ í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€ UI ë””ìì¸

## 1. í˜ì´ì§€ ê°œìš”

**ëª©ì **: ê° ê³„ì¢Œë³„ë¡œ ë³´ìœ  ì¢…ëª©ì„ í™•ì¸í•˜ê³ , ETF íˆ¬ì‹œ ê¸°ëŠ¥ìœ¼ë¡œ ë‚´ë¶€ êµ¬ì„± ì¢…ëª© ë¶„ì„

**ì£¼ìš” ê¸°ëŠ¥**:
- ê³„ì¢Œë³„ ì ‘ê¸°/í¼ì¹˜ê¸° (Expander)
- íƒ­ ë¶„ë¦¬: ë³´ìœ  ì¢…ëª© vs ETF íˆ¬ì‹œ
- ETF íˆ¬ì‹œëŠ” í† ê¸€ ë²„íŠ¼ìœ¼ë¡œ í™œì„±í™”
- ì„¹í„° ë¹„ì¤‘ íŒŒì´ ì°¨íŠ¸
- Top 10 ì œí•œìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”

## 2. ë ˆì´ì•„ì›ƒ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¦ ê³„ì¢Œë³„ í¬íŠ¸í´ë¦¬ì˜¤ - 2025-12                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  ğŸ“Œ íˆ¬ì (ì ˆì„¸) - ISA | í† ìŠ¤ì¦ê¶Œ | ì´ 800,000ì›               â–¼â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  [ë³´ìœ  ì¢…ëª©] [ETF íˆ¬ì‹œ ë¶„ì„]                              â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ğŸ“Š ë³´ìœ  ì¢…ëª© ë¦¬ìŠ¤íŠ¸                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ ì¢…ëª©ëª…          â”‚ í‹°ì»¤ â”‚ ê¸ˆì•¡     â”‚ ë¹„ì¤‘   â”‚ ìœ í˜•  â”‚ â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚  â”‚  â”‚ ACE ë¯¸êµ­ S&P500â”‚ SPY  â”‚ 300,000ì›â”‚ 37.5%  â”‚ STOCK â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ ACE ë¯¸êµ­êµ­ì±„30ë…„â”‚ TLT  â”‚ 200,000ì›â”‚ 25.0%  â”‚ BOND  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ ì¼ë°˜ì ê¸ˆ        â”‚ CASH â”‚ 300,000ì›â”‚ 37.5%  â”‚ CASH  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ğŸ“Š ì„¹í„° ë¹„ì¤‘ (Pie Chart)                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚           â•±â”€â”€â”€â”€â”€â”€â•²                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         â•±          â•²                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚        â”‚ Technology â”‚  37.5%                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚        â”‚   37.5%    â”‚                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         â•²          â•±                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    CASH  â•²â”€â”€â”€â”€â”€â”€â”€â•±  Fixed Income                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    37.5%              25.0%                        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  ğŸ“Œ ì—°ê¸ˆì €ì¶• - IRP | ì‹ í•œíˆ¬ìì¦ê¶Œ | ì´ 500,000ì›              â–¼â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  [ë³´ìœ  ì¢…ëª©] [ETF íˆ¬ì‹œ ë¶„ì„]                              â”‚ â”‚
â”‚  â”‚             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ğŸ” ETF íˆ¬ì‹œ í™œì„±í™”: [  OFF  ]  â† í† ê¸€ ë²„íŠ¼              â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  â„¹ï¸ ETF íˆ¬ì‹œë¥¼ í™œì„±í™”í•˜ë©´ ETF ë‚´ë¶€ êµ¬ì„± ì¢…ëª©ì„ í™•ì¸í•  ìˆ˜   â”‚ â”‚
â”‚  â”‚     ìˆìŠµë‹ˆë‹¤.                                            â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  ğŸ“Œ ì—°ê¸ˆì €ì¶• - IRP (ETF íˆ¬ì‹œ í™œì„±í™” ì‹œ)                       â–¼â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  [ë³´ìœ  ì¢…ëª©] [ETF íˆ¬ì‹œ ë¶„ì„]                              â”‚ â”‚
â”‚  â”‚             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ğŸ” ETF íˆ¬ì‹œ í™œì„±í™”: [  ON   ]  â† í† ê¸€ ë²„íŠ¼              â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ğŸ” ETF ë‚´ë¶€ êµ¬ì„± ì¢…ëª© (Top 10)                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ ì¢…ëª©    â”‚ ë¹„ì¤‘   â”‚ ë‚´ ë³´ìœ  ê¸ˆì•¡ â”‚ ì¶œì²˜ ETF         â”‚ â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚  â”‚  â”‚ AAPL    â”‚ 7.2%   â”‚ 36,000ì›     â”‚ SPY              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ MSFT    â”‚ 6.5%   â”‚ 32,500ì›     â”‚ SPY              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ NVDA    â”‚ 5.8%   â”‚ 29,000ì›     â”‚ SPY              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ GOOGL   â”‚ 4.2%   â”‚ 21,000ì›     â”‚ SPY              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ ...     â”‚ ...    â”‚ ...          â”‚ ...              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ OTHER   â”‚ 50.0%  â”‚ 250,000ì›    â”‚ SPY              â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  âš ï¸ ETF ë‚´ ìƒìœ„ 10ê°œ ì¢…ëª©ë§Œ í‘œì‹œë©ë‹ˆë‹¤.                    â”‚ â”‚
â”‚  â”‚     ë‚˜ë¨¸ì§€ ì¢…ëª©ì€ 'OTHER'ë¡œ í•©ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.               â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. ì»´í¬ë„ŒíŠ¸ ìƒì„¸ ì„¤ê³„

### 3.1 ê³„ì¢Œ Expander

**ì»´í¬ë„ŒíŠ¸**: `st.expander()`

```python
def render(selected_month: str):
    """ê³„ì¢Œë³„ í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€ ë Œë”ë§"""

    st.header(f"ğŸ¦ ê³„ì¢Œë³„ í¬íŠ¸í´ë¦¬ì˜¤ - {selected_month}")

    # ê³„ì¢Œ ëª©ë¡ ì¡°íšŒ
    accounts = get_accounts(selected_month)

    if not accounts:
        st.warning("ì´ ë‹¬ì—ëŠ” ê³„ì¢Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
        return

    # ê° ê³„ì¢Œë³„ë¡œ Expander ìƒì„±
    for account in accounts:
        # ê³„ì¢Œ í—¤ë”
        header = f"ğŸ“Œ {account['name']} - {account['type']} | {account['broker']} | ì´ {account['total_value']:,}ì›"

        with st.expander(header, expanded=True):  # ì²« ë²ˆì§¸ëŠ” ìë™ í¼ì¹¨
            render_account_details(selected_month, account)
```

**ë°ì´í„° êµ¬ì¡°** (`accounts`):
```python
[
    {
        'id': 1,
        'name': 'íˆ¬ì (ì ˆì„¸)',
        'type': 'ISA',
        'broker': 'í† ìŠ¤ì¦ê¶Œ',
        'fee': 0.0015,
        'total_value': 800000
    },
    ...
]
```

### 3.2 íƒ­ êµ¬ì¡° (ë³´ìœ  ì¢…ëª© vs ETF íˆ¬ì‹œ)

**ì»´í¬ë„ŒíŠ¸**: `st.tabs()`

```python
def render_account_details(selected_month: str, account: dict):
    """ê³„ì¢Œ ìƒì„¸ ì •ë³´ ë Œë”ë§"""

    # íƒ­ ìƒì„±
    tab1, tab2 = st.tabs(["ë³´ìœ  ì¢…ëª©", "ETF íˆ¬ì‹œ ë¶„ì„"])

    with tab1:
        render_holdings_tab(selected_month, account)

    with tab2:
        render_etf_lookthrough_tab(selected_month, account)
```

### 3.3 ë³´ìœ  ì¢…ëª© íƒ­

**ì»´í¬ë„ŒíŠ¸**: `st.dataframe()` + `plotly.graph_objects.Pie`

```python
def render_holdings_tab(selected_month: str, account: dict):
    """ë³´ìœ  ì¢…ëª© íƒ­ ë Œë”ë§"""

    # ë³´ìœ  ì¢…ëª© ë°ì´í„° ì¡°íšŒ
    df_holdings = get_account_holdings(selected_month, account['id'])

    # í…Œì´ë¸” í‘œì‹œ
    st.subheader("ğŸ“Š ë³´ìœ  ì¢…ëª© ë¦¬ìŠ¤íŠ¸")

    # ë°ì´í„°í”„ë ˆì„ í¬ë§·íŒ…
    df_display = df_holdings.copy()
    df_display['ê¸ˆì•¡'] = df_display['amount'].apply(lambda x: f"{x:,}ì›")
    df_display['ë¹„ì¤‘'] = df_display['ratio'].apply(lambda x: f"{x:.1f}%")

    st.dataframe(
        df_display[['ì¢…ëª©ëª…', 'í‹°ì»¤', 'ê¸ˆì•¡', 'ë¹„ì¤‘', 'ìì‚°ìœ í˜•']],
        use_container_width=True,
        hide_index=True
    )

    st.divider()

    # ì„¹í„° ë¹„ì¤‘ ì°¨íŠ¸
    st.subheader("ğŸ“Š ì„¹í„° ë¹„ì¤‘")

    # ì„¹í„° ë°ì´í„° ì¡°íšŒ
    df_sectors = get_account_sectors(selected_month, account['id'])

    if not df_sectors.empty:
        fig = create_sector_pie_chart(df_sectors)
        st.plotly_chart(fig, use_container_width=True)
    else:
        st.info("ì„¹í„° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
```

**Sector Pie Chart êµ¬í˜„**:
```python
import plotly.graph_objects as go

def create_sector_pie_chart(df_sectors: pd.DataFrame):
    """
    ì„¹í„° ë¹„ì¤‘ íŒŒì´ ì°¨íŠ¸ ìƒì„±
    """
    fig = go.Figure(data=[go.Pie(
        labels=df_sectors['sector_name'],
        values=df_sectors['amount'],
        textinfo='label+percent',
        textposition='inside',
        marker=dict(
            colors=['#3498db', '#2ecc71', '#f39c12', '#e74c3c', '#9b59b6'],
            line=dict(color='white', width=2)
        )
    )])

    fig.update_layout(
        title="ì„¹í„°ë³„ ìì‚° ë¶„í¬",
        height=400,
        showlegend=True
    )

    return fig
```

### 3.4 ETF íˆ¬ì‹œ íƒ­ (í•µì‹¬ ê¸°ëŠ¥)

**ì»´í¬ë„ŒíŠ¸**: `st.toggle()` + `st.dataframe()`

```python
def render_etf_lookthrough_tab(selected_month: str, account: dict):
    """ETF íˆ¬ì‹œ íƒ­ ë Œë”ë§"""

    # í† ê¸€ ë²„íŠ¼ (unique key í•„ìš”)
    lookthrough_enabled = st.toggle(
        "ğŸ” ETF íˆ¬ì‹œ í™œì„±í™”",
        value=False,
        key=f"lookthrough_toggle_{account['id']}",
        help="ETF ë‚´ë¶€ êµ¬ì„± ì¢…ëª©ì„ í™•ì¸í•©ë‹ˆë‹¤ (ìƒìœ„ 10ê°œë§Œ í‘œì‹œ)"
    )

    if not lookthrough_enabled:
        st.info("ğŸ’¡ ETF íˆ¬ì‹œë¥¼ í™œì„±í™”í•˜ë©´ ETF ë‚´ë¶€ êµ¬ì„± ì¢…ëª©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
        return

    # ETF íˆ¬ì‹œ ë°ì´í„° ë¡œë”©
    with st.spinner("ETF êµ¬ì„± ì¢…ëª© ë¶„ì„ ì¤‘..."):
        df_lookthrough = get_etf_lookthrough(selected_month, account['id'], top_n=10)

    if df_lookthrough.empty:
        st.warning("ì´ ê³„ì¢Œì—ëŠ” ETFê°€ ì—†ê±°ë‚˜ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
        return

    # í…Œì´ë¸” í‘œì‹œ
    st.subheader("ğŸ” ETF ë‚´ë¶€ êµ¬ì„± ì¢…ëª© (Top 10)")

    # í¬ë§·íŒ…
    df_display = df_lookthrough.copy()
    df_display['ë¹„ì¤‘'] = df_display['holding_percent'].apply(lambda x: f"{x:.1f}%")
    df_display['ë‚´ ë³´ìœ  ê¸ˆì•¡'] = df_display['my_amount'].apply(lambda x: f"{x:,}ì›")

    st.dataframe(
        df_display[['ì¢…ëª©', 'ë¹„ì¤‘', 'ë‚´ ë³´ìœ  ê¸ˆì•¡', 'ì¶œì²˜ ETF']],
        use_container_width=True,
        hide_index=True
    )

    # ê²½ê³  ë©”ì‹œì§€
    st.caption("âš ï¸ ETF ë‚´ ìƒìœ„ 10ê°œ ì¢…ëª©ë§Œ í‘œì‹œë©ë‹ˆë‹¤. ë‚˜ë¨¸ì§€ ì¢…ëª©ì€ 'OTHER'ë¡œ í•©ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.")
```

**ë°ì´í„° êµ¬ì¡°** (`df_lookthrough`):
```python
   ì¢…ëª©    ë¹„ì¤‘(%)  ë‚´ë³´ìœ ê¸ˆì•¡   ì¶œì²˜ETF
0  AAPL    7.2     36000      SPY
1  MSFT    6.5     32500      SPY
2  NVDA    5.8     29000      SPY
3  GOOGL   4.2     21000      SPY
...
9  OTHER   50.0    250000     SPY
```

## 4. ë°ì´í„° ìš”êµ¬ì‚¬í•­

### 4.1 í•„ìš”í•œ í•¨ìˆ˜ (`data_loader.py`)

```python
@st.cache_data(ttl=3600)
def get_accounts(year_month: str) -> List[dict]:
    """
    í•´ë‹¹ ì›”ì˜ ëª¨ë“  ê³„ì¢Œ ì¡°íšŒ

    Returns:
        [
            {
                'id': int,
                'name': str,
                'type': str,
                'broker': str,
                'fee': float,
                'total_value': int
            },
            ...
        ]
    """
    pass

@st.cache_data(ttl=3600)
def get_account_holdings(year_month: str, account_id: int) -> pd.DataFrame:
    """
    ê³„ì¢Œë³„ ë³´ìœ  ì¢…ëª© ì¡°íšŒ

    Columns: ['ì¢…ëª©ëª…', 'í‹°ì»¤', 'amount', 'ratio', 'ìì‚°ìœ í˜•']
    """
    pass

@st.cache_data(ttl=3600)
def get_account_sectors(year_month: str, account_id: int) -> pd.DataFrame:
    """
    ê³„ì¢Œë³„ ì„¹í„° ë¹„ì¤‘ ì¡°íšŒ

    Columns: ['sector_name', 'amount', 'percent']
    """
    pass

@st.cache_data(ttl=86400)  # 24ì‹œê°„ ìºì‹± (ETF ë°ì´í„°ëŠ” ìì£¼ ì•ˆ ë°”ë€œ)
def get_etf_lookthrough(year_month: str, account_id: int, top_n: int = 10) -> pd.DataFrame:
    """
    ETF íˆ¬ì‹œ ë°ì´í„° ì¡°íšŒ (Top Në§Œ)

    Columns: ['ì¢…ëª©', 'holding_percent', 'my_amount', 'ì¶œì²˜ ETF']
    """
    pass
```

### 4.2 DB ì¿¼ë¦¬ ë¡œì§

```sql
-- ê³„ì¢Œ ëª©ë¡ ì¡°íšŒ
SELECT
    a.id,
    a.name,
    a.type,
    a.broker,
    a.fee,
    SUM(h.amount) as total_value
FROM accounts a
JOIN holdings h ON a.id = h.account_id
WHERE a.month_id = (SELECT id FROM months WHERE year_month = '2025-12')
GROUP BY a.id;

-- ê³„ì¢Œë³„ ë³´ìœ  ì¢…ëª©
SELECT
    h.name as ì¢…ëª©ëª…,
    h.ticker_mapping as í‹°ì»¤,
    h.amount,
    h.target_ratio as ratio,
    h.asset_type as ìì‚°ìœ í˜•
FROM holdings h
WHERE h.account_id = 1;

-- ê³„ì¢Œë³„ ì„¹í„° ë¹„ì¤‘
SELECT
    sector_name,
    SUM(my_amount) as amount,
    SUM(sector_percent) as percent
FROM analyzed_sectors
WHERE account_id = 1 AND month_id = (SELECT id FROM months WHERE year_month = '2025-12')
GROUP BY sector_name
ORDER BY amount DESC;

-- ETF íˆ¬ì‹œ (Top 10)
SELECT
    stock_symbol as ì¢…ëª©,
    holding_percent,
    my_amount,
    source_ticker as ì¶œì²˜ETF
FROM analyzed_holdings
WHERE account_id = 1
  AND month_id = (SELECT id FROM months WHERE year_month = '2025-12')
  AND asset_type = 'STOCK'
ORDER BY my_amount DESC
LIMIT 10;
```

## 5. ì„±ëŠ¥ ìµœì í™” ì „ëµ

### 5.1 ìºì‹± ì „ëµ

```python
# ETF íˆ¬ì‹œ ë°ì´í„°ëŠ” 24ì‹œê°„ ìºì‹± (ë°ì´í„° ë³€ê²½ ë¹ˆë„ ë‚®ìŒ)
@st.cache_data(ttl=86400)
def get_etf_lookthrough(...):
    pass

# ê³„ì¢Œ/ë³´ìœ ì¢…ëª© ë°ì´í„°ëŠ” 1ì‹œê°„ ìºì‹±
@st.cache_data(ttl=3600)
def get_account_holdings(...):
    pass
```

### 5.2 Top N ì œí•œ

```python
# ê¸°ë³¸ 10ê°œë¡œ ì œí•œ
def get_etf_lookthrough(year_month: str, account_id: int, top_n: int = 10):
    """
    ìƒìœ„ Nê°œë§Œ ì¡°íšŒí•˜ì—¬ ìŠ¤í¬ë¡¤ ìµœì†Œí™”
    ë‚˜ë¨¸ì§€ëŠ” 'OTHER'ë¡œ í•©ì‚°
    """
    pass
```

### 5.3 Lazy Loading (í† ê¸€ í™œì„±í™” ì‹œì—ë§Œ ë¡œë”©)

```python
# ETF íˆ¬ì‹œëŠ” í† ê¸€ì´ ì¼œì§ˆ ë•Œë§Œ ë°ì´í„° ë¡œë”©
if lookthrough_enabled:
    df = get_etf_lookthrough(...)  # ì´ë•Œë§Œ DB ì¿¼ë¦¬ ì‹¤í–‰
else:
    # ë¡œë”©í•˜ì§€ ì•ŠìŒ -> ì„±ëŠ¥ í–¥ìƒ
    pass
```

## 6. ì—ëŸ¬ ì²˜ë¦¬

### 6.1 ê³„ì¢Œ ì—†ìŒ

```python
accounts = get_accounts(selected_month)

if not accounts:
    st.warning(f"âš ï¸ {selected_month}ì—ëŠ” ê³„ì¢Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
    st.stop()
```

### 6.2 ETF ë°ì´í„° ì—†ìŒ

```python
df_lookthrough = get_etf_lookthrough(selected_month, account_id)

if df_lookthrough.empty:
    st.info("ì´ ê³„ì¢Œì—ëŠ” ETFê°€ ì—†ê±°ë‚˜ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
```

### 6.3 ì°¨íŠ¸ ë Œë”ë§ ì‹¤íŒ¨

```python
try:
    fig = create_sector_pie_chart(df_sectors)
    st.plotly_chart(fig)
except Exception as e:
    st.error(f"ì°¨íŠ¸ ìƒì„± ì‹¤íŒ¨: {e}")
    # í…Œì´ë¸”ë¡œ ëŒ€ì²´
    st.table(df_sectors)
```

## 7. ì™„ì„± ì½”ë“œ ìŠ¤ì¼€ì¹˜

```python
# streamlit_app/pages/account_portfolio.py

import streamlit as st
import plotly.graph_objects as go
from streamlit_app.data_loader import (
    get_accounts,
    get_account_holdings,
    get_account_sectors,
    get_etf_lookthrough
)

def render(selected_month: str):
    """ê³„ì¢Œë³„ í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€ ë Œë”ë§"""

    st.header(f"ğŸ¦ ê³„ì¢Œë³„ í¬íŠ¸í´ë¦¬ì˜¤ - {selected_month}")

    # ê³„ì¢Œ ëª©ë¡ ì¡°íšŒ
    with st.spinner("ê³„ì¢Œ ë°ì´í„° ë¡œë”© ì¤‘..."):
        accounts = get_accounts(selected_month)

    if not accounts:
        st.warning(f"âš ï¸ {selected_month}ì—ëŠ” ê³„ì¢Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
        st.stop()

    # ê° ê³„ì¢Œë³„ Expander
    for idx, account in enumerate(accounts):
        header = f"ğŸ“Œ {account['name']} - {account['type']} | {account['broker']} | ì´ {account['total_value']:,}ì›"

        with st.expander(header, expanded=(idx == 0)):  # ì²« ë²ˆì§¸ë§Œ í¼ì¹¨
            render_account_details(selected_month, account)


def render_account_details(selected_month: str, account: dict):
    """ê³„ì¢Œ ìƒì„¸ ì •ë³´ ë Œë”ë§"""

    tab1, tab2 = st.tabs(["ë³´ìœ  ì¢…ëª©", "ETF íˆ¬ì‹œ ë¶„ì„"])

    with tab1:
        render_holdings_tab(selected_month, account)

    with tab2:
        render_etf_lookthrough_tab(selected_month, account)


def render_holdings_tab(selected_month: str, account: dict):
    """ë³´ìœ  ì¢…ëª© íƒ­"""

    df = get_account_holdings(selected_month, account['id'])

    st.subheader("ğŸ“Š ë³´ìœ  ì¢…ëª© ë¦¬ìŠ¤íŠ¸")
    # í¬ë§·íŒ… í›„ í‘œì‹œ
    df_display = df.copy()
    df_display['ê¸ˆì•¡'] = df_display['amount'].apply(lambda x: f"{x:,}ì›")
    df_display['ë¹„ì¤‘'] = df_display['ratio'].apply(lambda x: f"{x:.1f}%")

    st.dataframe(df_display[['ì¢…ëª©ëª…', 'í‹°ì»¤', 'ê¸ˆì•¡', 'ë¹„ì¤‘', 'ìì‚°ìœ í˜•']], use_container_width=True, hide_index=True)

    st.divider()

    st.subheader("ğŸ“Š ì„¹í„° ë¹„ì¤‘")
    df_sectors = get_account_sectors(selected_month, account['id'])

    if not df_sectors.empty:
        fig = create_sector_pie_chart(df_sectors)
        st.plotly_chart(fig, use_container_width=True)
    else:
        st.info("ì„¹í„° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")


def render_etf_lookthrough_tab(selected_month: str, account: dict):
    """ETF íˆ¬ì‹œ íƒ­"""

    lookthrough_enabled = st.toggle(
        "ğŸ” ETF íˆ¬ì‹œ í™œì„±í™”",
        value=False,
        key=f"lookthrough_{account['id']}",
        help="ETF ë‚´ë¶€ êµ¬ì„± ì¢…ëª© í™•ì¸ (Top 10)"
    )

    if not lookthrough_enabled:
        st.info("ğŸ’¡ ETF íˆ¬ì‹œë¥¼ í™œì„±í™”í•˜ë©´ ETF ë‚´ë¶€ êµ¬ì„± ì¢…ëª©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
        return

    with st.spinner("ETF ë¶„ì„ ì¤‘..."):
        df = get_etf_lookthrough(selected_month, account['id'], top_n=10)

    if df.empty:
        st.warning("ETF ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
        return

    st.subheader("ğŸ” ETF ë‚´ë¶€ êµ¬ì„± ì¢…ëª© (Top 10)")

    df_display = df.copy()
    df_display['ë¹„ì¤‘'] = df_display['holding_percent'].apply(lambda x: f"{x:.1f}%")
    df_display['ë‚´ ë³´ìœ  ê¸ˆì•¡'] = df_display['my_amount'].apply(lambda x: f"{x:,}ì›")

    st.dataframe(df_display[['ì¢…ëª©', 'ë¹„ì¤‘', 'ë‚´ ë³´ìœ  ê¸ˆì•¡', 'ì¶œì²˜ ETF']], use_container_width=True, hide_index=True)
    st.caption("âš ï¸ ìƒìœ„ 10ê°œ ì¢…ëª©ë§Œ í‘œì‹œë©ë‹ˆë‹¤.")


def create_sector_pie_chart(df_sectors):
    """ì„¹í„° íŒŒì´ ì°¨íŠ¸"""
    fig = go.Figure(data=[go.Pie(
        labels=df_sectors['sector_name'],
        values=df_sectors['amount'],
        textinfo='label+percent',
        marker=dict(line=dict(color='white', width=2))
    )])

    fig.update_layout(title="ì„¹í„°ë³„ ìì‚° ë¶„í¬", height=400)
    return fig
```
